<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JAMBO SAMAKI â€“ Gestionnaire Admin</title>
<meta name="theme-color" content="#1bb5a7">

<style>
body{margin:0;font-family:"Segoe UI",sans-serif;background:linear-gradient(to bottom,#00c6ff,#0072ff);min-height:100vh}
header{background:rgba(0,128,128,0.95);color:white;text-align:center;padding:1.3rem;font-size:1.3rem}
.container{padding:1rem}
.card{background:white;border-radius:16px;padding:1rem;margin-bottom:1.5rem;box-shadow:0 8px 18px rgba(0,0,0,0.2)}
h2{color:#008080}
input,select{width:100%;padding:.6rem;margin:.3rem 0 .8rem 0;border-radius:8px;border:1px solid #ccc}
button{background:#20b2aa;color:white;border:none;padding:.6rem;border-radius:10px;cursor:pointer;width:100%}
button:hover{background:#178f8f}
table{width:100%;border-collapse:collapse;font-size:.9rem}
th{background:#20b2aa;color:white}
th,td{border:1px solid #ddd;padding:.4rem;text-align:left}
.status{border-radius:8px}
.whatsapp-btn{background:#25D366;border-radius:8px}
</style>
</head>
<body>

<header>ğŸŒŠ JAMBO SAMAKI â€“ Gestionnaire ADMIN ğŸŸ</header>
<div class="container">

<!-- Ajouter commande -->
<div class="card">
<h2>â• Ajouter une commande</h2>
<input id="clientName" placeholder="Nom du client">
<select id="product">
  <option>Sol</option>
  <option>Capitaine</option>
  <option>Malua</option>
  <option>Crevettes</option>
  <option>Mabundu</option>
  <option>Poisson-chat</option>
</select>
<input id="quantity" placeholder="QuantitÃ© (ex: 5 kg)">
<input id="address" placeholder="Adresse de livraison">
<input id="whatsapp" placeholder="+243xxxxxxxxx">
<button onclick="addOrder()">Ajouter la commande</button>
</div>

<!-- Commandes -->
<div class="card">
<h2>ğŸ“¦ Commandes</h2>
<table>
<thead>
<tr><th>#</th><th>Nom</th><th>Produit</th><th>QtÃ©</th><th>Adresse</th><th>WhatsApp</th><th>Statut</th><th>Action</th></tr>
</thead>
<tbody id="ordersTable"></tbody>
</table>
</div>

<!-- Historique clients -->
<div class="card">
<h2>ğŸ‘¥ Historique clients</h2>
<table>
<thead>
<tr><th>Nom</th><th>WhatsApp</th><th>Commandes</th><th>Produits</th><th>DerniÃ¨re</th></tr>
</thead>
<tbody id="clientsTable"></tbody>
</table>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

<script>
  // Config Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyC89JFEcpTFPXNZh9qhmu7nnm_mia6Q8YY",
    authDomain: "jambo-samaki-admin.firebaseapp.com",
    projectId: "jambo-samaki-admin",
    storageBucket: "jambo-samaki-admin.appspot.com",
    messagingSenderId: "189558490878",
    appId: "1:189558490878:web:fa90455a2a829ef446c7af"
  };

  // Init Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const ordersCollection = db.collection("orders");

  // Ajouter commande
  window.addOrder = async function() {
    const name = document.getElementById("clientName").value;
    const product = document.getElementById("product").value;
    const quantity = document.getElementById("quantity").value;
    const address = document.getElementById("address").value;
    const whatsapp = document.getElementById("whatsapp").value;

    if(!name || !quantity || !address || !whatsapp){
      alert("Remplis tous les champs");
      return;
    }

    await ordersCollection.add({
      name, product, quantity, address, whatsapp,
      status: "En attente",
      date: new Date().toLocaleString()
    });

    document.getElementById("clientName").value = "";
    document.getElementById("quantity").value = "";
    document.getElementById("address").value = "";
    document.getElementById("whatsapp").value = "";
  };

  // Modifier statut
  window.updateStatus = async function(id,status){
    await ordersCollection.doc(id).update({status});
  };

  // Observer commandes
  ordersCollection.onSnapshot(snapshot=>{
    const orders = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));

    // Table commandes
    const t = document.getElementById("ordersTable");
    t.innerHTML = "";
    orders.forEach((o,i)=>{
      t.innerHTML += `<tr>
<td>${i+1}</td>
<td>${o.name}</td>
<td>${o.product}</td>
<td>${o.quantity}</td>
<td>${o.address}</td>
<td>${o.whatsapp}</td>
<td><select onchange="updateStatus('${o.id}', this.value)">
<option ${o.status=="En attente"?"selected":""}>En attente</option>
<option ${o.status=="En livraison"?"selected":""}>En livraison</option>
<option ${o.status=="LivrÃ©"?"selected":""}>LivrÃ©</option>
<option ${o.status=="AnnulÃ©"?"selected":""}>AnnulÃ©</option>
</select></td>
<td><button onclick="window.open('https://wa.me/${o.whatsapp.replace('+','')}','_blank')">WhatsApp</button></td>
</tr>`;
    });

    // Historique clients
    const clients = {};
    orders.forEach(o=>{
      if(!clients[o.whatsapp]) clients[o.whatsapp]={name:o.name,count:0,prods:[],last:""};
      clients[o.whatsapp].count++;
      clients[o.whatsapp].prods.push(o.product);
      clients[o.whatsapp].last=o.date;
    });
    const c = document.getElementById("clientsTable");
    c.innerHTML = "";
    Object.entries(clients).forEach(([num,cl])=>{
      c.innerHTML += `<tr>
<td>${cl.name}</td>
<td>${num}</td>
<td>${cl.count}</td>
<td>${cl.prods.join(", ")}</td>
<td>${cl.last}</td>
</tr>`;
    });
  });
</script>

</body>
</html>
